## 6.4 Implementation of Core and Feature Modules

This section describes the implementation of Modula’s core and feature modules as realized in Capstone I. Each subsection explains the responsibility of the module, how it is implemented in the system, and how it interacts with other modules. While not all modules are production-complete, all described implementations are aligned with the defined Capstone I scope and architectural constraints.

---

### 6.4.1 Authentication and Authorization

Authentication and authorization form the entry point to the Modula POS system. The authentication component is responsible for validating user credentials and establishing an authenticated session, while the authorization mechanism determines which system capabilities are accessible to the user based on role and branch context.

In the current implementation, users authenticate using credential-based login. Role-based access control (RBAC) is enforced throughout the system, with roles such as Administrator, Manager, and Cashier determining access to operational features such as sales, inventory, and reporting. Authorization checks are consistently applied at module boundaries, ensuring that protected actions cannot be executed without appropriate permission.

Although OTP-based verification and advanced identity workflows are planned for future phases, the existing authentication and authorization mechanism is sufficient to support secure role separation and branch-scoped access in Capstone I.

---

### 6.4.2 Tenant Context

---

### 6.4.3 Branch Management

Branch Management is a core module responsible for representing operational locations under a tenant. A branch is not created manually by users; instead, it is provisioned automatically by the system when a tenant is created or when an additional branch is added through subscription changes.

Each branch maintains its own operational identity, including name, address, and contact information. Branches can be placed into a *frozen* state by the system, typically due to subscription changes or administrative action. When a branch is frozen, operational actions such as sales, inventory updates, cash sessions, and attendance check-ins are blocked. However, historical data associated with the branch remains accessible for reporting and auditing purposes.

This separation between tenant and branch allows Modula to model real-world business operations accurately, where each location operates independently while remaining under a single organizational owner.

---

### 6.4.4 Policy and Configuration

The Policy and Configuration module defines operational rules that govern system behavior. Policies are resolved in the context of a branch, allowing different branches under the same tenant to operate with distinct configurations.

Implemented policies include tax and currency handling, inventory behavior, cash session enforcement, and attendance constraints. For example, policies determine whether inventory is automatically deducted upon sale, whether a cash session is required before performing sales, and whether out-of-shift attendance requires managerial approval.

Policy evaluation occurs at runtime and is enforced consistently across modules. Branch freezing does not alter policy definitions but prevents policy-driven operations from being executed on frozen branches.

---

### 6.4.5 Sale and Order Management

Sale and Order Management constitutes the transactional core of the Modula POS system. Sales begin with the creation of a cart, allowing users to add items, select modifiers, and apply branch-scoped discounts. If policy requires an active cash session, the system enforces this condition before permitting cart interaction.

Upon checkout, the cart is finalized into a sale record and an associated order. Pricing calculations—including discounts, tax, and currency conversion—are resolved at finalization and locked to ensure immutability. Orders progress through a controlled lifecycle (e.g., in preparation, ready, delivered), enabling operational tracking without altering financial records.

Sale voiding is implemented as an approval-based workflow. Cashiers may request a void, transitioning the sale to a pending state until reviewed by an Administrator or Manager. Approved voids trigger compensating actions such as inventory restoration and cash adjustment, while rejected requests return the sale to its prior state.

---

### 6.4.6 Menu Management

The Menu Management module handles the creation and maintenance of menu items, categories, modifiers, and branch availability. Menu items can be assigned to one or multiple branches, allowing centralized control while supporting branch-specific offerings.

Menu configuration is designed to be flexible and modular, supporting different pricing structures and modifier combinations. Menu data is frequently accessed and therefore cached client-side to improve performance and reduce network dependency.

---

### 6.4.7 Inventory Management

Inventory Management tracks stock items, restocking activities, and inventory journals at the branch level. Stock quantities are maintained using base units to ensure accurate deduction and reporting.

Inventory updates may occur through restocking operations or automatic deduction following sales, depending on policy configuration. Expiry tracking is supported, enabling batch-level visibility for perishable goods. Frozen branches are prevented from performing inventory mutations, while historical inventory records remain available.

---

### 6.4.8 Cash Session and Reconciliation

The Cash Session module manages cash handling during operational shifts. Users open a cash session before performing cash-based sales when required by policy. Cash movements—including paid-in, paid-out, and refunds—are recorded against the active session.

At session closure, the system computes expected cash values and reconciles them against counted amounts. Discrepancies are recorded for auditing purposes. Cash sessions are strictly scoped to branches, and frozen branches block session creation and mutation.

---

### 6.4.9 Staff Management

Staff Management governs the association of users with branches and roles. Staff records define operational permissions but do not manage authentication credentials directly, which remain within the authentication module.

Administrators can assign roles and branch access to staff members. Staff belonging to frozen branches retain their records but are prevented from performing operational actions until the branch is reactivated.

---

### 6.4.10 Staff Attendance

The Staff Attendance module records check-in and check-out events for staff members at the branch level. Attendance behavior is governed by policy, including out-of-shift approval requirements and early check-in buffers.

Attendance records are immutable once created. Managers may approve out-of-shift entries but cannot alter timestamps. Attendance for frozen branches is blocked while preserving historical records.

---

### 6.4.11 Discount Management

Discount Management enables the creation and application of percentage-based discounts scoped to branches. Discounts may apply to individual items or entire sales and are resolved during cart calculation.

Discounts are locked at sale finalization to prevent retroactive changes. Branch freezing prevents discount application without deleting or altering discount definitions.

---

### 6.4.12 Receipt and eReceipt

The Receipt module generates transactional receipts and electronic receipts based on finalized sales. Receipt content is derived from sale data and branch context, including branding and contact information sourced from branch configuration.

Footer customization is supported on a per-branch basis. Receipt generation remains available for historical sales even if the branch is frozen.

---

### 6.4.13 Reporting

The Reporting module aggregates operational data for administrative review. Reports include sales summaries, inventory status, cash reconciliation, and attendance logs. Reporting is available to administrators and remains accessible for frozen branches, clearly indicating branch status.

Pending void transactions are included in reports with appropriate labels to maintain financial transparency.

---

### 6.4.14 Sync and Offline Support

Sync and Offline Support enables the system to operate under intermittent connectivity. Client-side actions are queued and synchronized with the backend when connectivity is restored.

The backend enforces authority during synchronization. Writes targeting frozen branches are rejected deterministically, and clients surface clear error messages to prevent retry storms.

---

### 6.4.15 Audit Logging

Audit Logging records significant system events across modules, including branch lifecycle actions such as provisioning, freezing, and unfreezing. Operational denials caused by frozen branches are optionally logged for traceability.

Audit logs provide an immutable record supporting accountability, troubleshooting, and future compliance requirements.